<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MED MADAD | Smart Hospital Queue</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- üîä Hospital Sound -->
<audio id="notify">
  <source src="https://actions.google.com/sounds/v1/alarms/soft_bell.ogg" type="audio/ogg">
</audio>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  color: #fff;
  text-align: center;
  transition: background 0.5s;
}

header {
  padding: 20px;
}

.logo {
  font-size: 30px;
  font-weight: bold;
}

.tagline {
  font-size: 14px;
  opacity: 0.9;
}

.container {
  max-width: 420px;
  margin: auto;
  background: #ffffff;
  color: #111;
  border-radius: 18px;
  padding: 20px;
}

select, input, button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

.card {
  background: #f1f5f9;
  border-radius: 14px;
  padding: 16px;
  margin: 12px 0;
}

.token {
  font-size: 46px;
  font-weight: bold;
}

button {
  background: #020617;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

footer {
  margin-top: 20px;
  font-size: 12px;
  opacity: 0.85;
}
</style>
</head>

<body id="body">

<header>
  <div class="logo">üè• MED MADAD</div>
  <div class="tagline">Smart care ‚Ä¢ Less waiting ‚Ä¢ Better health</div>
</header>

<div class="container">

<select id="department" onchange="applyTheme(); listen();">
  <option value="medicine">Medicine</option>
  <option value="gynaecology">Gynaecology</option>
  <option value="orthopedic">Orthopedic</option>
  <option value="surgery">Surgery</option>
  <option value="pediatrics">Pediatrics</option>
</select>

<div class="card">
  Issued Token
  <div class="token" id="issued">0</div>
</div>

<div class="card">
  Now Serving
  <div class="token" id="running">0</div>
</div>

<input type="password" id="password" placeholder="Doctor password">
<input type="number" id="newIssued" placeholder="New issued token">
<input type="number" id="newRunning" placeholder="New running token">

<button onclick="updateTokens()">Update Tokens</button>

</div>

<footer>
‚ö†Ô∏è For information only. Please wait for your turn.<br>
Created by Raj
</footer>

<script>
/* üî• FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "medmadad-2a807.firebaseapp.com",
  projectId: "medmadad-2a807"
});

const db = firebase.firestore();

/* üîê PASSWORDS (FIXED) */
const passwords = {
  medicine: "1111",
  gynaecology: "4444",
  orthopedic: "2222",
  surgery: "3333",
  pediatrics: "5555"
};

/* üé® CALM MEDICAL COLORS */
const themes = {
  medicine: "#0f766e",
  gynaecology: "#9d174d",
  orthopedic: "#1e3a8a",
  surgery: "#7f1d1d",
  pediatrics: "#047857"
};

let lastRunning = 0;
let unsubscribe = null;

/* üìÖ TODAY */
function today() {
  return new Date().toISOString().slice(0,10);
}

/* üé® THEME APPLY */
function applyTheme() {
  const d = department.value;
  body.style.background =
    `linear-gradient(135deg, ${themes[d]}, #020617)`;
}

/* üì° LIVE LISTENER + DAILY RESET */
function listen() {
  const d = department.value;

  if (unsubscribe) unsubscribe();

  const ref = db.collection("departments").doc(d);
  unsubscribe = ref.onSnapshot(doc => {
    if (!doc.exists || doc.data().date !== today()) {
      ref.set({
        issuedToken: 0,
        runningToken: 0,
        date: today(),
        password: passwords[d]
      });
      return;
    }

    issued.innerText = doc.data().issuedToken;
    running.innerText = doc.data().runningToken;

    if (doc.data().runningToken !== lastRunning) {
      document.getElementById("notify").play();
      lastRunning = doc.data().runningToken;
    }
  });
}

/* ‚úèÔ∏è UPDATE TOKENS */
function updateTokens() {
  const d = department.value;
  if (password.value !== passwords[d]) {
    alert("Incorrect password for " + d);
    return;
  }

  db.collection("departments").doc(d).update({
    issuedToken: Number(newIssued.value),
    runningToken: Number(newRunning.value),
    date: today()
  });
}

applyTheme();
listen();
</script>

</body>
</html>
